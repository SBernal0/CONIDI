{% extends 'base.html' %}
{% block title %}Cambiar Contraseña{% endblock %}

{% block content %}
<h2>Cambiar Contraseña</h2>

<p>Se ha detectado que estás usando una contraseña temporal. Por favor, cámbiala para continuar.</p>



<form method="post" class="w-50" id="form-cambiar-clave">
    {% csrf_token %}
    <div class="mb-3">
        <label>Nueva contraseña</label>
        <input type="password" name="nueva_clave" id="nueva_clave" class="form-control" required>
    </div>
    <div class="mb-3">
        <label>Confirmar nueva contraseña</label>
        <input type="password" name="confirmar_clave" id="confirmar_clave" class="form-control" required>
        <small id="msg-clave" class="text-danger"></small>
    </div>
    <button type="submit" class="btn btn-success">Actualizar contraseña</button>
</form>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const clave = document.getElementById("nueva_clave");
    const confirmarClave = document.getElementById("confirmar_clave");
    const mensaje = document.getElementById("msg-clave");
    const formulario = document.getElementById("form-cambiar-clave");

    function validarCoincidencia() {
        if (confirmarClave.value === "") {
            mensaje.textContent = "";
            confirmarClave.classList.remove("is-invalid", "is-valid");
            return;
        }

        if (clave.value === confirmarClave.value) {
            mensaje.textContent = "Las contraseñas coinciden ✅";
            mensaje.classList.remove("text-danger");
            mensaje.classList.add("text-success");
            confirmarClave.classList.remove("is-invalid");
            confirmarClave.classList.add("is-valid");
        } else {
            mensaje.textContent = "Las contraseñas no coinciden ❌";
            mensaje.classList.remove("text-success");
            mensaje.classList.add("text-danger");
            confirmarClave.classList.remove("is-valid");
            confirmarClave.classList.add("is-invalid");
        }
    }

    clave.addEventListener("input", validarCoincidencia);
    confirmarClave.addEventListener("input", validarCoincidencia);

    formulario.addEventListener("submit", (e) => {
        if (clave.value !== confirmarClave.value) {
            e.preventDefault();
            alert("Las contraseñas no coinciden. Corrige antes de continuar.");
        }
    });
});
</script>
{% endblock %}
