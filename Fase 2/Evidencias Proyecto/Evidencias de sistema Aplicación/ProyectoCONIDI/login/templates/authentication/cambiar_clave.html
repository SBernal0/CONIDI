{% extends 'base.html' %}

{% block title %}Cambiar Contraseña{% endblock %}

{% block content %}
<h2>Cambiar Contraseña</h2>

{% for message in messages %}
  <div class="alert alert-{{ message.tags }}">{{ message }}</div>
{% endfor %}

<form method="post" class="w-50" id="form-cambiar-clave">
    {% csrf_token %}
    <div class="mb-3">
    <label>Contraseña actual</label>
    <input type="password" name="clave_actual" id="clave_actual" class="form-control" required>
    </div>

    <div class="mb-3">
        <label>Nueva contraseña</label>
        <input type="password" name="nueva_clave" id="nueva_clave" class="form-control" required>
    </div>
    <div class="mb-3">
        <label>Confirmar nueva contraseña</label>
        <input type="password" name="confirmar_clave" id="confirmar_clave" class="form-control" required>
        <small id="msg-clave" class="text-danger"></small>
    </div>
    <button type="submit" class="btn btn-success">Cambiar contraseña</button>
</form>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const nueva = document.getElementById("nueva_clave");
    const confirmar = document.getElementById("confirmar_clave");
    const msg = document.getElementById("msg-clave");
    const form = document.getElementById("form-cambiar-clave");

    function validarCoincidencia() {
        if (confirmar.value === "") {
            msg.textContent = "";
            confirmar.classList.remove("is-invalid", "is-valid");
            return;
        }
        if (nueva.value === confirmar.value) {
            msg.textContent = "Las contraseñas coinciden ✅";
            msg.classList.remove("text-danger");
            msg.classList.add("text-success");
            confirmar.classList.remove("is-invalid");
            confirmar.classList.add("is-valid");
        } else {
            msg.textContent = "Las contraseñas no coinciden ❌";
            msg.classList.remove("text-success");
            msg.classList.add("text-danger");
            confirmar.classList.remove("is-valid");
            confirmar.classList.add("is-invalid");
        }
    }

    nueva.addEventListener("input", validarCoincidencia);
    confirmar.addEventListener("input", validarCoincidencia);

    form.addEventListener("submit", (e) => {
        if (nueva.value !== confirmar.value) {
            e.preventDefault();
            alert("Las contraseñas no coinciden.");
        }
    });
});
</script>
{% endblock %}
