{% extends 'base.html' %}
{% load static %}

{% block title %}Detalle: {{ control.nombre_control }}{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/estilodetalles.css' %}">
{% endblock %}

{% block content %}


<div class="page-header mb-3 animate-fade-in-up">
    <h2><i class="bi bi-clipboard2-pulse-fill me-2"></i>Detalle: {{ control.nombre_control }}</h2>
    <p class="text-muted">
        <strong>Niño/a:</strong> {{ nino.nombre }} {{ nino.ap_paterno }} |
        <strong>Fecha Realización:</strong> {{ control.fecha_realizacion_control|date:"d/m/Y"|default:"<span class='text-warning fw-bold'>Pendiente</span>"|safe }}
    </p>
</div>

<div class="card detail-form-card">
    <div class="detail-form-header">
        <span class="icon"><i class="bi bi-file-earmark-medical-fill"></i></span>
        <h5>Resumen del Control Realizado</h5>
    </div>
    <div class="detail-form-body">

        <div class="form-section" style="animation-delay: 0.1s;">
            <h6 class="form-section-title"><i class="bi bi-rulers"></i>Datos Antropométricos</h6>
            <div class="row form-fields-grid">
                <div class="col-md-3 col-6 form-field">
                    <span class="field-label"><i class="bi bi-cassette"></i> Peso</span>
                    <span class="field-value">{{ control.pesokg|default:"N/A" }} kg</span>
                </div>
                <div class="col-md-3 col-6 form-field">
                    <span class="field-label"><i class="bi bi-arrows-vertical"></i> Talla</span>
                    <span class="field-value">{{ control.talla_cm|default:"N/A" }} cm</span>
                </div>
                <div class="col-md-3 col-6 form-field">
                    <span class="field-label"><i class="bi bi-calculator"></i> IMC</span>
                    <span class="field-value"><code>{{ control.imc|default:"N/A" }}</code></span>
                </div>
                <div class="col-md-3 col-6 form-field">
                    <span class="field-label"><i class="bi bi-bullseye"></i> P. Craneal</span>
                    <span class="field-value">{{ control.pc_cm|default:"N/A" }} cm</span>
                </div>
            </div>
        </div>

        <div class="form-section" style="animation-delay: 0.2s;">
            <h6 class="form-section-title"><i class="bi bi-clipboard2-check-fill"></i>Calificaciones y Diagnósticos</h6>
            <div class="row form-fields-grid">
                <div class="col-md-6 form-field">
                    <span class="field-label">Nutricional</span>
                    <span class="field-value">{{ control.calificacion_nutricional|default:"N/A" }}</span>
                </div>
                <div class="col-md-6 form-field">
                    <span class="field-label">Estatural</span>
                    <span class="field-value">{{ control.get_calificacion_estatural_display|default:"N/A" }}</span>
                </div>
                <div class="col-md-6 form-field">
                    <span class="field-label">P/CE</span>
                    <span class="field-value">{{ control.get_calificacion_pce_display|default:"N/A" }}</span>
                </div>
                <div class="col-md-6 form-field">
                    <span class="field-label">Presión Arterial</span>
                    <span class="field-value">{{ control.get_dig_pa_display|default:"N/A" }}</span>
                </div>
            </div>
        </div>

        <div class="form-section" style="animation-delay: 0.3s;">
             <h6 class="form-section-title"><i class="bi bi-file-earmark-richtext-fill"></i>Diagnóstico, Observaciones e Indicaciones</h6>
             <div class="row form-fields-grid detail-text"> {# Usamos detail-text aquí para estilo de párrafos #}
                 <div class="col-12 form-field">
                     <span class="field-label">Diagnóstico Desarrollo Integral</span>
                     <span class="field-value large-text">{{ control.diag_des_integral|default:"<span class='text-muted fst-italic'>Sin registro.</span>"|safe }}</span>
                 </div>
                 <div class="col-12 form-field">
                     <span class="field-label">Observaciones Desarrollo Integral</span>
                     <span class="field-value large-text">{{ control.obs_desarrollo_integral|default:"<span class='text-muted fst-italic'>Sin registro.</span>"|safe }}</span>
                 </div>
                 <div class="col-12 form-field">
                     <span class="field-label">Observaciones Generales</span>
                     <span class="field-value large-text">{{ control.observaciones|default:"<span class='text-muted fst-italic'>Sin registro.</span>"|safe }}</span>
                 </div>
                 <div class="col-12 form-field">
                     <span class="field-label">Indicaciones</span>
                     <span class="field-value large-text">{{ control.indicaciones|default:"<span class='text-muted fst-italic'>Sin registro.</span>"|safe }}</span>
                 </div>
             </div>
        </div>

        <div class="form-section" style="animation-delay: 0.4s;">
             <h6 class="form-section-title"><i class="bi bi-person-check-fill"></i>Derivaciones y Profesional</h6>
             <div class="row form-fields-grid">
                 <div class="col-md-4 col-6 form-field">
                     <span class="field-label">Requiere Derivación</span>
                     <span class="field-value {% if control.derivacion %}status-si{% else %}status-no{% endif %}">
                         {% if control.derivacion %}<i class="bi bi-check-circle-fill"></i>Sí{% else %}<i class="bi bi-x-circle-fill"></i>No{% endif %}
                     </span>
                 </div>
                  <div class="col-md-4 col-6 form-field">
                     <span class="field-label">Consulta Dental</span>
                     <span class="field-value {% if control.consulta_dental_realizada %}status-si{% else %}status-no{% endif %}">
                         {% if control.consulta_dental_realizada %}<i class="bi bi-check-circle-fill"></i>Realizada{% else %}<i class="bi bi-x-circle-fill"></i>No Realizada{% endif %}
                     </span>
                 </div>
                  <div class="col-md-4 col-12 form-field"> {# col-12 para que ocupe todo en móvil #}
                     <span class="field-label">Derivación Dentista</span>
                     <span class="field-value {% if control.derivacion_dentista %}status-si{% else %}status-no{% endif %}">
                         {% if control.derivacion_dentista %}<i class="bi bi-check-circle-fill"></i>Sí{% else %}<i class="bi bi-x-circle-fill"></i>No{% endif %}
                     </span>
                 </div>
                 <div class="col-12 form-field mt-3"> {# Separador y ancho completo #}
                     <span class="field-label">Profesional a Cargo</span>
                     <span class="field-value">
                         {% if control.profesional %}
                             <i class="bi bi-person-fill"></i> {{ control.profesional.usuario.nombre_completo }}
                             <small class="text-muted d-block ps-4">{{ control.profesional.especialidad|default:"" }}</small>
                         {% else %}
                             <span class='text-muted fst-italic'>No asignado</span>
                         {% endif %}
                     </span>
                 </div>
             </div>
        </div>

    </div> <div class="detail-card-footer">
        <a href="{% url 'control:detalle_nino' nino.rut_nino %}" class="btn btn-secondary">
            <i class="bi bi-arrow-left-circle me-1"></i>Volver
        </a>
        {% if request.user.rol.nombre_rol|lower == 'administrador' %}
            <a href="{% url 'control:historial_control' control.id %}" class="btn btn-info text-white">
                <i class="bi bi-clock-history me-1"></i>Historial
            </a>
        {% endif %}
    </div>
</div> {% endblock %}