{% extends 'base.html' %}
{% load static %} {# <-- Asegúrate de tener esto al inicio #}

{% block title %}Historial de Configuración de Vacunas{% endblock %}

{% block extra_css %}
    {# Enlazamos la hoja de estilos compartida #}
    <link rel="stylesheet" href="{% static 'css/estilohistorial.css' %}">
{% endblock %}

{% block content %}

<div class="page-header d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2><i class="bi bi-shield-plus me-2"></i>Historial de Configuración de Vacunas</h2>
        <p class="text-muted mb-0">Registro de todas las modificaciones hechas a las vacunas del sistema.</p>
    </div>
    <a href="{% url 'control:configurar_vacunas' %}" class="btn btn-secondary">
        <i class="bi bi-arrow-left me-1"></i>Volver a Configuración
    </a>
</div>

{# --- Bucle para mostrar cada versión del historial --- #}
{% for version in historial %}
    {# Definimos variables según el tipo de historial #}
    {% with history_type_class=version.history_type|lower %}
        {% if history_type_class == '+' %}
            {% with card_class="type-create" icon_class="bi-plus-circle-fill icon-create" action_text="creada" %} {# Cambiado a 'creada' #}
                <div class="card history-card {{ card_class }}" style="--i: {{ forloop.counter0 }};">
                    <div class="history-header">
                        <div class="action-info">
                            <span class="action-icon"><i class="bi {{ icon_class }}"></i></span>
                            <span>Vacuna <strong>{{ version.nom_vacuna }}</strong> fue {{ action_text }}</span>
                            <span class="user-info"> por <strong>{{ version.history_user.nombre_completo|default:'Sistema' }}</strong></span>
                        </div>
                        <span class="timestamp"><i class="bi bi-calendar-event me-1"></i>{{ version.history_date|date:"d/m/Y, H:i" }}</span>
                    </div>
                    <div class="history-body">
                        {# Incluimos el detalle, pasando el contexto #}
                        {% include 'control/config/includes/historial_vacunas_detalle.html' with version=version action_text=action_text %}
                    </div>
                </div>
            {% endwith %}

        {% elif history_type_class == '~' %}
            {% with card_class="type-update" icon_class="bi-pencil-fill icon-update" action_text="modificada" %} {# Cambiado a 'modificada' #}
                 <div class="card history-card {{ card_class }}" style="--i: {{ forloop.counter0 }};">
                     <div class="history-header">
                        <div class="action-info">
                            <span class="action-icon"><i class="bi {{ icon_class }}"></i></span>
                            <span>Vacuna <strong>{{ version.nom_vacuna }}</strong> fue {{ action_text }}</span>
                            <span class="user-info"> por <strong>{{ version.history_user.nombre_completo|default:'Sistema' }}</strong></span>
                        </div>
                        <span class="timestamp"><i class="bi bi-calendar-event me-1"></i>{{ version.history_date|date:"d/m/Y, H:i" }}</span>
                    </div>
                    <div class="history-body">
                        {# Incluimos el detalle, pasando el contexto #}
                        {% include 'control/config/includes/historial_vacunas_detalle.html' with version=version action_text=action_text %}
                    </div>
                </div>
            {% endwith %}

        {% elif history_type_class == '-' %}
             {% with card_class="type-delete" icon_class="bi-trash-fill icon-delete" action_text="eliminada" %} {# Cambiado a 'eliminada' #}
                 <div class="card history-card {{ card_class }}" style="--i: {{ forloop.counter0 }};">
                    <div class="history-header">
                        <div class="action-info">
                            <span class="action-icon"><i class="bi {{ icon_class }}"></i></span>
                            <span>Vacuna <strong>{{ version.nom_vacuna }}</strong> fue {{ action_text }}</span>
                            <span class="user-info"> por <strong>{{ version.history_user.nombre_completo|default:'Sistema' }}</strong></span>
                        </div>
                        <span class="timestamp"><i class="bi bi-calendar-event me-1"></i>{{ version.history_date|date:"d/m/Y, H:i" }}</span>
                    </div>
                    <div class="history-body">
                        {# Incluimos el detalle, pasando el contexto #}
                        {% include 'control/config/includes/historial_vacunas_detalle.html' with version=version action_text=action_text %}
                    </div>
                </div>
            {% endwith %}

        {% else %}
             {% with card_class="" icon_class="" action_text="cambiada" %} {# Fallback #}
                 <div class="card history-card {{ card_class }}" style="--i: {{ forloop.counter0 }};">
                     <div class="history-header">
                        <div class="action-info">
                            <span class="action-icon"><i class="bi {{ icon_class }}"></i></span>
                            <span>Vacuna <strong>{{ version.nom_vacuna }}</strong> fue {{ action_text }}</span>
                            <span class="user-info"> por <strong>{{ version.history_user.nombre_completo|default:'Sistema' }}</strong></span>
                        </div>
                        <span class="timestamp"><i class="bi bi-calendar-event me-1"></i>{{ version.history_date|date:"d/m/Y, H:i" }}</span>
                    </div>
                    <div class="history-body">
                        {# Incluimos el detalle, pasando el contexto #}
                        {% include 'control/config/includes/historial_vacunas_detalle.html' with version=version action_text=action_text %}
                    </div>
                </div>
            {% endwith %}
        {% endif %}
    {% endwith %}

{% empty %}
    <div class="alert alert-info animate-fade-in-up">
        <i class="bi bi-info-circle-fill me-2"></i>No hay historial de cambios para mostrar.
    </div>
{% endfor %}


{% endblock %}
